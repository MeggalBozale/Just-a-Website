<!DOCTYPE html>
<html> 
  <head>
    <title>Processing.JS inside Webpages: Template</title> 
  </head>
  <body>
	<!--This draws the canvas on the webpage -->
    <canvas id="mycanvas"></canvas> 
  </body>
 
  <!-- Include the processing.js library -->
  <!-- See https://khanacademy.zendesk.com/hc/en-us/articles/202260404-What-parts-of-ProcessingJS-does-Khan-Academy-support- for differences -->
  <script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script> 
  <script>
  var programCode = function(processingInstance) {
    with (processingInstance) {
      size(1366,768); 
      frameRate(30);
        
      // Paste code from Khan Academy here:
      var AorB = "A"; //temp? mebbe.
        var schoolScheds = [];

var drawRange = function(start) {
    var incAmount = 0.005; noStroke();
    for (var t = start; t < 1*incAmount*width+start; t += incAmount) {
        var n = noise(t);
        var y = map(n, 0, 1, 0, height/2);
        rect(2*((t*100)-(start*100)),height-y+60,4,300);
    }
};

/**
Heya! Head down to the bottom for some explanation.
*/

var drawRanges = function(amount)
{
    for(var i = 0; i < amount; i++)
    {
        fill(200-(i*(255/amount)),200-(i*(255/amount)),255-(i*(255/amount)));
        pushMatrix();
        translate(0,(i*8)-100);
        drawRange((amount-i)*200);
        popMatrix();
    }
    
};

var drawClouds = function(start)
{
    var incAmount = 0.001;
    for (var t = 0; t < width; t++) {
        var n = noise(incAmount);
        var y = map(n, 0, 1, 0, height/4);
        //drawNoise();
        stroke(200,200,200,100);
        line(t,0,t,y);
        incAmount += 0.005;
    }
};

var drawGradient = function(rgb1,rgb2)
{   
    //Precondition: rgb1[i] >= rgb2[i]
    strokeWeight(1);
    for(var i = 0; i < height-height/8; i++){
        //idea of color is to slowly transition into other rgb val
        stroke(((rgb1[0]*((255-i*0.63)/255))+(rgb2[0]*(i*0.63/255)))  ,
               ((rgb1[1]*((255-i*0.63)/255))+(rgb2[1]*(i*0.63/255)))  ,
               ((rgb1[2]*((255-i*0.63)/255))+(rgb2[2]*(i*0.63/255)))  );
        line(0,i+height/8,width,i+height/8);
    }
};

/*=========================================================
===========================================================
===========================================================
=========================================================*/

var TimeTracker = function(s,e,n,d,i)
{ //Contructor.
    this.s = s; //start HH:MM
    this.e = e; //end   HH:MM
    this.n = n;    //name
    this.d = d;    //A or B day
    this.i = i; //to track what period it is
};

TimeTracker.prototype.pad0s = function(str,amt,right)
{ //Pads something with 0s to its left/right. Will do left unless specified
    str = "" + str;
    while(str.length < amt)
    {
        if(!right){
            str = "0" + str;
        }
        else{
            str = str + "0";
        }
    }
    return str;
};

TimeTracker.prototype.getMillis = function()
{ //TODO: Make this track millis for this.display()
    
};

TimeTracker.prototype.getToSeconds = function(){
    var toSeconds = [0,0,0]; // [start,end,current]
    //3600 is seconds in an hour. 60 is seconds in a minute.
    toSeconds[0] = this.s[0]*3600 + this.s[1]*60;
    toSeconds[1] = this.e[0]*3600 + this.e[1]*60;
    toSeconds[2] = hour()*3600 + minute()*60 + second();
    return toSeconds;
    //Returns:
    //[start time in seconds,
    // end time in seconds,
    // current time in seconds]
};

TimeTracker.prototype.getTimeLeft = function(){
    
    var toSeconds = this.getToSeconds();
    //time left in seconds, [start,end,current] like above
    var timeLeftS = toSeconds[1]-toSeconds[2];
    var timeLeft = [0,0,0];
    timeLeft[0] = Math.floor(timeLeftS/3600);
    timeLeft[1] = Math.floor(timeLeftS/60)%60;
    timeLeft[2] = Math.floor(timeLeftS%60);
    return timeLeft;
    
};
TimeTracker.prototype.showSchedBlock = function(options)
{ //Shows SO many things. It's the crowl jewel of the program
    
    //set options up
    var x = options[0];
    var y = options[1];
    var a = options[2];
    var showHHMMSS = options[3];
    var showPercentLeft = options[4];
    var showSecondsLeft = options[5];
    var showBar = options[6];
    var showAB = options[7];
    var showNext = options[8];
    var showCurrent = options[9];
    //I know it's not *technically* required, but I want to know
    //what these options mean in the future, so... readability!
    
    //Step 1: convert to seconds
    var toSeconds = this.getToSeconds();
    
    //Condition to check if curr time outside start-end time
    if(toSeconds[2] < toSeconds[0] || 
       toSeconds[2] >=  toSeconds[1]) {return;}
    
    //Step 2: get the difference, and other calculations.
    var secondsDuration = toSeconds[1] - toSeconds[0];
    var percent = 100*(toSeconds[2]-toSeconds[0])/secondsDuration;
    percent = Math.floor(percent*100)/100; //rounds percent for obv reasons
    
    //The time left in seconds and such.
    var timeLeftS = toSeconds[1]-toSeconds[2];
    var timeLeft = this.getTimeLeft();
    var finalTleft = this.pad0s(timeLeft[0],2) + ":" +
                     this.pad0s(timeLeft[1],2) + ":" +
                     this.pad0s(timeLeft[2],2);
    var tempPct = percent + "";
    if(tempPct.length === 2){
        tempPct = tempPct + ".00";
    }
    
    textSize(height/16);
    fill(255,255,255);
    //The seconds left, ex. 0395s
    if(showSecondsLeft){
        text("Time left: " + this.pad0s(timeLeftS,4) + "s",x,y-10);
    }
    
    //The percent left. Ex. 10.34%
    if(showPercentLeft){
        text(this.pad0s(Math.floor(100*(100-tempPct))/100,5,true) + "%", x, y+30);
    }
    
    //The time left, in HH:MM:SS format, like 03:45:37
    if(showHHMMSS){
        fill(255,255,255); textSize(height/20);
        text(finalTleft,width/2,height/2+30);
    }
    
    //A progress bar
    if(showBar){
        strokeWeight(4);
        
        stroke(200,0,0,a);
        line(width/5,height/4,4*width/5,height/4);
        
        stroke(0,200,0,a);
        line(width/5,height/4,((width/5)+((3*width/5)*(percent/100))),height/4);
    }
    
    //the A/B day
    if(showAB){
        fill(0,0,0);
        textSize(height/10);
        text(AorB,width/16,height/16);
    }
    
    fill(255,255,255);
    textSize(30);
    
    //The next class
    if(showNext){
        text("Next: \n" + schoolScheds[this.i].n,5*width/6,height/2);
    }
    
    //The current class
    if(showCurrent){
        text("Current: \n" + this.n,width/6,height/2);
    }

};

TimeTracker.prototype.display = function()
{ //Displays the current time and nothing more.
    //HOURS:MINUTES:SECONDS:MILLISECONDS
    textAlign(CENTER,CENTER);
    fill(0,0,0);
    textSize(height/8);
    var hr  = this.pad0s(hour()  ,2);
    var min = this.pad0s(minute(),2);
    var sec = this.pad0s(second(),2);
    
    fill(100,100,100);
    strokeWeight(7);
    rect(0,0,width,height/8);
    stroke(0,0,0);
    line(0,height/8,width,height/8);
    quad(width/8,0,(7*width/8),0,(7*width/8)-25,height/4,width/8+25,height/4);
    
    
    fill(0,0,0);
    text(hr + ":" + min + ":" + sec,width/2,height/8);
};

var time = new TimeTracker(); //For the clock on the top

//All scheds for school
/*
    //A
schoolScheds[0] = new TimeTracker([7,59], [8,55], "Algebra",  "A",1);
schoolScheds[1] = new TimeTracker([8,59], [9,55], "Chemistry","A",2);
schoolScheds[2] = new TimeTracker([9,59], [10,55],"History",  "A",3);
schoolScheds[3] = new TimeTracker([10,59],[11,55],"Phys. Ed", "A",7);
    //B is names only as it will replace A, for efficiency
if(AorB === "B")
{
schoolScheds[0].n = "CSAEA";      schoolScheds[0].d = "B";
schoolScheds[1].n = "Study Hall"; schoolScheds[1].d = "B";
schoolScheds[2].n = "Web Design"; schoolScheds[2].d = "B";
schoolScheds[3].n = "English";    schoolScheds[3].d = "B";
}
    //Interims
schoolScheds[4] = new TimeTracker([8,55], [8,59], "To: " + schoolScheds[1].n,"",1);
schoolScheds[5] = new TimeTracker([9,55], [9,59], "To: " + schoolScheds[2].n,"",2);
schoolScheds[6] = new TimeTracker([10,55],[10,59],"To: " + schoolScheds[3].n,"",3);
schoolScheds[7] = new TimeTracker([11,55],[12,0], "To the bus",             "",9);
    //Homeroom
schoolScheds[8] = new TimeTracker([7,30],[7,45],"Pre HR" , "",9);
schoolScheds[9] = new TimeTracker([7,45],[7,59],"Homeroom","",0);
schoolScheds[10] = new TimeTracker([20,0],[24,0],"Night","",8);
*/
schoolScheds[0] = new TimeTracker([8,0],[11,55],"END OF SCHOOL WOO","A",0);
draw = function() {
    
    drawGradient([255,0,255],[0,0,55]);
    
    drawRanges(5); 
    noStroke();
    
    for(var i = 0; i < 20; i++){
        fill(100-i*5,100-i*5,100-i*5);
        ellipse(width/2,height/2+30,-(i*3)+width/4,-(i*3)+width/4);
    }
    
    time.display();
    for(var i = 0; i < schoolScheds.length; i++){
        schoolScheds[i].showSchedBlock([width/2,height/3,255,true,true,true,true,true,true,true]);
    }
};
    }};

  // Get the canvas that ProcessingJS will use
  var canvas = document.getElementById("mycanvas"); 
  // Pass the function to ProcessingJS constructor
  var processingInstance = new Processing(canvas, programCode); 
  </script>
</html>
